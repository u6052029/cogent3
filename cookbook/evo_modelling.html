
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Evolutionary Analysis Using Likelihood &#8212; cogent3 2020.2.7a documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-dataframe.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="../_static/require.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Useful Utilities" href="useful_utilities.html" />
    <link rel="prev" title="Building phylogenies" href="building_phylogenies.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">cogent3</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../warning.html">Warning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../app/index.html">The <code class="docutils literal notranslate"><span class="pre">apps</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../draw/index.html">Image Gallery</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../library.html">The Library</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Cookbook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/index.html">Usage Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data_file_links.html">Data Files Used in the Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../licenses.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general.html">Posting Bugs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general.html#citation">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general.html#support">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../general.html#search">Search</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../library.html">The Library</a><ul>
  <li><a href="index.html">Cookbook</a><ul>
      <li>Previous: <a href="building_phylogenies.html" title="previous chapter">Building phylogenies</a></li>
      <li>Next: <a href="useful_utilities.html" title="next chapter">Useful Utilities</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Evolutionary-Analysis-Using-Likelihood">
<h1>Evolutionary Analysis Using Likelihood<a class="headerlink" href="#Evolutionary-Analysis-Using-Likelihood" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Specifying-substitution-models">
<h2>Specifying substitution models<a class="headerlink" href="#Specifying-substitution-models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="The-available-pre-defined-substitution-models">
<h3>The available pre-defined substitution models<a class="headerlink" href="#The-available-pre-defined-substitution-models" title="Permalink to this headline">¶</a></h3>
<p>In cases where code takes a substitution model as an argument, you can use the value under “Abbreviation” as a string.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">available_models</span>

<span class="n">available_models</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Specify a model using 'Abbreviation' (case sensitive).</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>Model Type</th>
<th>Abbreviation</th>
<th>Description</th>
</thead>
<tbody>
<tr>
<td>nucleotide</td>
<td>JC69</td>
<td>Jukes and Cantor's 1969 model</td>
</tr>
<tr>
<td>nucleotide</td>
<td>K80</td>
<td>Kimura 1980</td>
</tr>
<tr>
<td>nucleotide</td>
<td>F81</td>
<td>Felsenstein's 1981 model</td>
</tr>
<tr>
<td>nucleotide</td>
<td>HKY85</td>
<td>Hasegawa, Kishino and Yanamo 1985 model</td>
</tr>
<tr>
<td>nucleotide</td>
<td>TN93</td>
<td>Tamura and Nei 1993 model</td>
</tr>
<tr>
<td>nucleotide</td>
<td>GTR</td>
<td>General Time Reversible nucleotide substitution model.</td>
</tr>
<tr>
<td>nucleotide</td>
<td>ssGN</td>
<td>strand-symmetric general Markov nucleotide (non-stationary, non-reversible). Kaehler, 2017, Journal of Theoretical Biology 420: 144–51</td>
</tr>
<tr>
<td>nucleotide</td>
<td>GN</td>
<td>General Markov Nucleotide (non-stationary, non-reversible). Kaehler, Yap, Zhang, Huttley, 2015, Sys Biol 64 (2): 281–93</td>
</tr>
<tr>
<td>nucleotide</td>
<td>BH</td>
<td>Barry and Hartigan Discrete Time substitution model Barry and Hartigan 1987. Biometrics 43: 261–76.</td>
</tr>
<tr>
<td>nucleotide</td>
<td>DT</td>
<td>Discrete Time substitution model (non-stationary, non-reversible). motif_length=2 makes this a dinucleotide model, motif_length=3 a trinucleotide model.</td>
</tr>
<tr>
<td>codon</td>
<td>CNFGTR</td>
<td>Conditional nucleotide frequency codon substitution model, GTR variant (with params analagous to the nucleotide GTR model). Yap, Lindsay, Easteal and Huttley, 2010, Mol Biol Evol 27: 726-734</td>
</tr>
<tr>
<td>codon</td>
<td>CNFHKY</td>
<td>Conditional nucleotide frequency codon substitution model, HKY variant (with kappa, the ratio of transitions to transversions) Yap, Lindsay, Easteal and Huttley, 2010, Mol Biol Evol 27: 726-734</td>
</tr>
<tr>
<td>codon</td>
<td>MG94HKY</td>
<td>Muse and Gaut 1994 codon substitution model, HKY variant (with kappa, the ratio of transitions to transversions) Muse and Gaut, 1994, Mol Biol Evol, 11, 715-24</td>
</tr>
<tr>
<td>codon</td>
<td>MG94GTR</td>
<td>Muse and Gaut 1994 codon substitution model, GTR variant (with params analagous to the nucleotide GTR model) Muse and Gaut, 1994, Mol Biol Evol, 11, 715-24</td>
</tr>
<tr>
<td>codon</td>
<td>GY94</td>
<td>Goldman and Yang 1994 codon substitution model. N Goldman and Z Yang, 1994, Mol Biol Evol, 11(5):725-36.</td>
</tr>
<tr>
<td>codon</td>
<td>Y98</td>
<td>Yang's 1998 substitution model, a derivative of the GY94. Z Yang, 1998, Mol Biol Evol, 15(5):568-73</td>
</tr>
<tr>
<td>codon</td>
<td>H04G</td>
<td>Huttley 2004 CpG substitution model. Includes a term for substitutions to or from CpG's. GA Huttley, 2004, Mol Biol Evol, 21(9):1760-8</td>
</tr>
<tr>
<td>codon</td>
<td>H04GK</td>
<td>Huttley 2004 CpG substitution model. Includes a term for transition substitutions to or from CpG's. GA Huttley, 2004, Mol Biol Evol, 21(9):1760-8</td>
</tr>
<tr>
<td>codon</td>
<td>H04GGK</td>
<td>Huttley 2004 CpG substitution model. Includes a general term for substitutions to or from CpG's and an adjustment for CpG transitions. GA Huttley, 2004, Mol Biol Evol, 21(9):1760-8</td>
</tr>
<tr>
<td>codon</td>
<td>GNC</td>
<td>General Nucleotide Codon, a non-reversible codon model. Kaehler, Yap, Huttley, 2017, Gen Biol Evol 9(1): 134–49</td>
</tr>
<tr>
<td>protein</td>
<td>DSO78</td>
<td>Dayhoff et al 1978 empirical protein model Dayhoff, MO, Schwartz RM, and Orcutt, BC. 1978 A model of evolutionary change in proteins. Pp. 345-352. Atlas of protein sequence and structure, Vol 5, Suppl. 3. National Biomedical Research Foundation, Washington D. C Matrix imported from PAML dayhoff.dat file</td>
</tr>
<tr>
<td>protein</td>
<td>AH96</td>
<td>Adachi and Hasegawa 1996 empirical model for mitochondrial proteins. Adachi J, Hasegawa M. Model of amino acid substitution in proteins encoded by mitochondrial DNA. J Mol Evol. 1996 Apr;42(4):459-68. Matrix imported from PAML mtREV24.dat file</td>
</tr>
<tr>
<td>protein</td>
<td>AH96_mtmammals</td>
<td>Adachi and Hasegawa 1996 empirical model for mammalian mitochondrial proteins. Adachi J, Hasegawa M. Model of amino acid substitution in proteins encoded by mitochondrial DNA. J Mol Evol. 1996 Apr;42(4):459-68. Matrix imported from PAML mtmam.dat file</td>
</tr>
<tr>
<td>protein</td>
<td>JTT92</td>
<td>Jones, Taylor and Thornton 1992 empirical protein model Jones DT, Taylor WR, Thornton JM. The rapid generation of mutation data matrices from protein sequences. Comput Appl Biosci. 1992 Jun;8(3):275-82. Matrix imported from PAML jones.dat file</td>
</tr>
<tr>
<td>protein</td>
<td>WG01</td>
<td>Whelan and Goldman 2001 empirical model for globular proteins. Whelan S, Goldman N. A general empirical model of protein evolution derived from multiple protein families using a maximum-likelihood approach. Mol Biol Evol. 2001 May;18(5):691-9. Matrix imported from PAML wag.dat file</td>
</tr>
</tbody>
</table>
<p>
25 rows x 3 columns</p></div>
</div>
</div>
<div class="section" id="Getting-a-substitution-model-with-get_model()">
<h3>Getting a substitution model with <code class="docutils literal notranslate"><span class="pre">get_model()</span></code><a class="headerlink" href="#Getting-a-substitution-model-with-get_model()" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">hky</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;HKY85&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hky</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

TimeReversibleNucleotide ( name = &#39;HKY85&#39;; type = &#39;None&#39;; params = [&#39;kappa&#39;]; number of motifs = 4; motifs = [&#39;T&#39;, &#39;C&#39;, &#39;A&#39;, &#39;G&#39;])

</pre></div></div>
</div>
</div>
<div class="section" id="Rate-heterogeneity-models">
<h3>Rate heterogeneity models<a class="headerlink" href="#Rate-heterogeneity-models" title="Permalink to this headline">¶</a></h3>
<p>We illustrate this for the gamma distributed case using examples of the canned models displayed above. Creating rate heterogeneity variants of the canned models can be done by using optional arguments that get passed to the substitution model class.</p>
<div class="section" id="For-nucleotide">
<h4>For nucleotide<a class="headerlink" href="#For-nucleotide" title="Permalink to this headline">¶</a></h4>
<p>We specify a general time reversible nucleotide model with gamma distributed rate heterogeneity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">sub_mod</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;GTR&quot;</span><span class="p">,</span> <span class="n">with_rate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sub_mod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

TimeReversibleNucleotide ( name = &#39;GTR&#39;; type = &#39;None&#39;; params = [&#39;A/C&#39;, &#39;A/G&#39;, &#39;A/T&#39;, &#39;C/G&#39;, &#39;C/T&#39;]; number of motifs = 4; motifs = [&#39;T&#39;, &#39;C&#39;, &#39;A&#39;, &#39;G&#39;])

</pre></div></div>
</div>
</div>
<div class="section" id="For-codon">
<h4>For codon<a class="headerlink" href="#For-codon" title="Permalink to this headline">¶</a></h4>
<p>We specify a conditional nucleotide frequency codon model with nucleotide general time reversible parameters and a parameter for the ratio of nonsynonymous to synonymous substitutions (omega) with gamma distributed rate heterogeneity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">sub_mod</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;CNFGTR&quot;</span><span class="p">,</span> <span class="n">with_rate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sub_mod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

TimeReversibleCodon ( name = &#39;CNFGTR&#39;; type = &#39;None&#39;; params = [&#39;A/C&#39;, &#39;A/G&#39;, &#39;A/T&#39;, &#39;C/G&#39;, &#39;C/T&#39;, &#39;omega&#39;]; number of motifs = 61; motifs = [&#39;TTT&#39;, &#39;TTC&#39;, &#39;TTA&#39;, &#39;TTG&#39;, &#39;TCT&#39;, &#39;TCC&#39;, &#39;TCA&#39;, &#39;TCG&#39;, &#39;TAT&#39;, &#39;TAC&#39;, &#39;TGT&#39;, &#39;TGC&#39;, &#39;TGG&#39;, &#39;CTT&#39;, &#39;CTC&#39;, &#39;CTA&#39;, &#39;CTG&#39;, &#39;CCT&#39;, &#39;CCC&#39;, &#39;CCA&#39;, &#39;CCG&#39;, &#39;CAT&#39;, &#39;CAC&#39;, &#39;CAA&#39;, &#39;CAG&#39;, &#39;CGT&#39;, &#39;CGC&#39;, &#39;CGA&#39;, &#39;CGG&#39;, &#39;ATT&#39;, &#39;ATC&#39;, &#39;ATA&#39;, &#39;ATG&#39;, &#39;ACT&#39;, &#39;ACC&#39;, &#39;ACA&#39;, &#39;ACG&#39;, &#39;AAT&#39;, &#39;AAC&#39;, &#39;AAA&#39;, &#39;AAG&#39;, &#39;AGT&#39;, &#39;AGC&#39;, &#39;AGA&#39;, &#39;AGG&#39;, &#39;GTT&#39;, &#39;GTC&#39;, &#39;GTA&#39;, &#39;GTG&#39;, &#39;GCT&#39;, &#39;GCC&#39;, &#39;GCA&#39;, &#39;GCG&#39;, &#39;GAT&#39;, &#39;GAC&#39;, &#39;GAA&#39;, &#39;GAG&#39;, &#39;GGT&#39;, &#39;GGC&#39;, &#39;GGA&#39;, &#39;GGG&#39;])

</pre></div></div>
</div>
</div>
<div class="section" id="For-protein">
<h4>For protein<a class="headerlink" href="#For-protein" title="Permalink to this headline">¶</a></h4>
<p>We specify a Jones, Taylor and Thornton 1992 empirical protein substitution model with gamma distributed rate heterogeneity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">sub_mod</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;JTT92&quot;</span><span class="p">,</span> <span class="n">with_rate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sub_mod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Empirical ( name = &#39;JTT92&#39;; type = &#39;None&#39;; number of motifs = 20; motifs = [&#39;A&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;K&#39;, &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;V&#39;, &#39;W&#39;, &#39;Y&#39;])

</pre></div></div>
</div>
</div>
</div>
</div>
<div class="section" id="Making-a-likelihood-function">
<h2>Making a likelihood function<a class="headerlink" href="#Making-a-likelihood-function" title="Permalink to this headline">¶</a></h2>
<p>You start by specifying a substitution model and use that to construct a likelihood function for a specific tree.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">make_tree</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">sub_mod</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">make_tree</span><span class="p">(</span><span class="s1">&#39;(a,b,(c,d))&#39;</span><span class="p">)</span>

<span class="n">lf</span> <span class="o">=</span> <span class="n">sub_mod</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Providing-an-alignment-to-a-likelihood-function">
<h3>Providing an alignment to a likelihood function<a class="headerlink" href="#Providing-an-alignment-to-a-likelihood-function" title="Permalink to this headline">¶</a></h3>
<p>You need to load an alignment and then provide it a likelihood function. I construct very simple trees and alignments for this example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">make_tree</span><span class="p">,</span> <span class="n">make_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>
<span class="n">sub_mod</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">make_tree</span><span class="p">(</span><span class="s1">&#39;(a,b,(c,d))&#39;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sub_mod</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">make_aligned_seqs</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;ACGT&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;AC-T&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;ACGT&#39;</span><span class="p">),</span>
                     <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;AC-T&#39;</span><span class="p">)])</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Scoping-parameters-on-trees-–-time-heterogeneous-models">
<h3>Scoping parameters on trees – time heterogeneous models<a class="headerlink" href="#Scoping-parameters-on-trees-–-time-heterogeneous-models" title="Permalink to this headline">¶</a></h3>
<p>For many evolutionary analyses, it’s desirable to allow different branches on a tree to have different values of a parameter. We show this for a simple codon model case here where we want the great apes (the clade that includes human and orangutan) to have a different value of the ratio of nonsynonymous to synonymous substitutions. This parameter is identified in the precanned <code class="docutils literal notranslate"><span class="pre">CNFGTR</span></code> model as <code class="docutils literal notranslate"><span class="pre">omega</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">ascii_art</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
          /-Galago
         |
-root----|--HowlerMon
         |
         |          /-Rhesus
          \edge.3--|
                   |          /-Orangutan
                    \edge.2--|
                             |          /-Gorilla
                              \edge.1--|
                                       |          /-Human
                                        \edge.0--|
                                                  \-Chimpanzee
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;CNFGTR&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="n">tip_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Human&#39;</span><span class="p">,</span> <span class="s1">&#39;Orangutan&#39;</span><span class="p">],</span> <span class="n">outgroup_name</span><span class="o">=</span><span class="s1">&#39;Galago&#39;</span><span class="p">,</span> <span class="n">clade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We’ve set an <em>initial</em> value for this clade so that the edges affected by this rule are evident below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<h4>Likelihood function statistics</h4>

<p>number of free parameters = 78</p>
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Global params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>A/C</th>
<th>A/G</th>
<th>A/T</th>
<th>C/G</th>
<th>C/T</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
</tbody>
</table>

<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Edge params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>edge</th>
<th>parent</th>
<th>length</th>
<th>omega</th>
</thead>
<tbody>
<tr>
<td>Galago</td>
<td>root</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
<tr>
<td>HowlerMon</td>
<td>root</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
<tr>
<td>Rhesus</td>
<td>edge.3</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
<tr>
<td>Orangutan</td>
<td>edge.2</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">0.5000</td>
</tr>
<tr>
<td>Gorilla</td>
<td>edge.1</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">0.5000</td>
</tr>
<tr>
<td>Human</td>
<td>edge.0</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">0.5000</td>
</tr>
<tr>
<td>Chimpanzee</td>
<td>edge.0</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">0.5000</td>
</tr>
<tr>
<td>edge.0</td>
<td>edge.1</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">0.5000</td>
</tr>
<tr>
<td>edge.1</td>
<td>edge.2</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">0.5000</td>
</tr>
<tr>
<td>edge.2</td>
<td>edge.3</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
<tr>
<td>edge.3</td>
<td>root</td>
<td style="font-family: monospace !important;">1.0000</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
</tbody>
</table>

<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Motif params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>AAA</th>
<th>AAC</th>
<th>AAG</th>
<th>AAT</th>
<th>ACA</th>
<th>ACC</th>
<th>ACG</th>
<th>ACT</th>
<th>AGA</th>
<th>AGC</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
</tr>
</tbody>
</table>
<table>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>AGG</th>
<th>AGT</th>
<th>ATA</th>
<th>ATC</th>
<th>ATG</th>
<th>ATT</th>
<th>CAA</th>
<th>CAC</th>
<th>CAG</th>
<th>CAT</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
</tr>
</tbody>
</table>
<table>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>CCA</th>
<th>CCC</th>
<th>CCG</th>
<th>CCT</th>
<th>CGA</th>
<th>CGC</th>
<th>CGG</th>
<th>CGT</th>
<th>CTA</th>
<th>CTC</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
</tr>
</tbody>
</table>
<table>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>CTG</th>
<th>CTT</th>
<th>GAA</th>
<th>GAC</th>
<th>GAG</th>
<th>GAT</th>
<th>GCA</th>
<th>GCC</th>
<th>GCG</th>
<th>GCT</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
</tr>
</tbody>
</table>
<table>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>GGA</th>
<th>GGC</th>
<th>GGG</th>
<th>GGT</th>
<th>GTA</th>
<th>GTC</th>
<th>GTG</th>
<th>GTT</th>
<th>TAC</th>
<th>TAT</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
</tr>
</tbody>
</table>
<table>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>TCA</th>
<th>TCC</th>
<th>TCG</th>
<th>TCT</th>
<th>TGC</th>
<th>TGG</th>
<th>TGT</th>
<th>TTA</th>
<th>TTC</th>
<th>TTG</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
<td style="font-family: monospace !important;">0.0164</td>
</tr>
</tbody>
</table>
<table>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>TTT</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.0164</td>
</tr>
</tbody>
</table></div>
</div>
<p>A more extensive description of capabilities is in <a class="reference internal" href="../examples/scope_model_params_on_trees.html#scope-params-on-trees"><span class="std std-ref">Allowing substitution model parameters to differ between branches</span></a>.</p>
</div>
<div class="section" id="Specifying-a-parameter-as-constant">
<h3>Specifying a parameter as constant<a class="headerlink" href="#Specifying-a-parameter-as-constant" title="Permalink to this headline">¶</a></h3>
<p>This means the parameter will not be modified during likelihood maximisation. We show this here by making the <code class="docutils literal notranslate"><span class="pre">omega</span></code> parameter constant at the value 1 – essentially the condition of selective neutrality.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;CNFGTR&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="n">is_constant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Providing-a-starting-value-for-a-parameter">
<h3>Providing a starting value for a parameter<a class="headerlink" href="#Providing-a-starting-value-for-a-parameter" title="Permalink to this headline">¶</a></h3>
<p>This can be useful to improve performance, the closer you are to the maximum likelihood estimator the quicker optimisation will be.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;CNFGTR&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Setting-parameter-bounds-for-optimisation">
<h3>Setting parameter bounds for optimisation<a class="headerlink" href="#Setting-parameter-bounds-for-optimisation" title="Permalink to this headline">¶</a></h3>
<p>This can be useful for stopping optimisers from getting stuck in a bad part of parameter space. The following is for <code class="docutils literal notranslate"><span class="pre">omega</span></code> in a codon model. I’m also providing an initial guess for the parameter (<code class="docutils literal notranslate"><span class="pre">init=0.1</span></code>) as well as a lower bound. An initial guess that is close to the maximum likelihood estimate will speed up optimisation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;CNFGTR&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Setting-an-upper-bound-for-branch-length">
<h3>Setting an upper bound for branch length<a class="headerlink" href="#Setting-an-upper-bound-for-branch-length" title="Permalink to this headline">¶</a></h3>
<p>If the branch length estimates seem too large, setting just an upper bound can be sensible. This will apply to all edges on the tree.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If, after optimising, the branch lengths equal to the upper value you set then the function has not been fully maximised and you should consider adjusting the boundary again.</p>
</div>
</div>
<div class="section" id="Specifying-rate-heterogeneity-functions">
<h3>Specifying rate heterogeneity functions<a class="headerlink" href="#Specifying-rate-heterogeneity-functions" title="Permalink to this headline">¶</a></h3>
<p>We extend the simple gamma distributed rate heterogeneity case for nucleotides from above to construction of the actual likelihood function. We do this for 4 bins and constraint the bin probabilities to be equal.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;GTR&quot;</span><span class="p">,</span> <span class="n">with_rate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;bprobs&#39;</span><span class="p">,</span> <span class="n">is_constant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For more detailed discussion of defining and using these models see <a class="reference internal" href="../examples/rate_heterogeneity.html#rate-heterogeneity"><span class="std std-ref">Analysis of rate heterogeneity</span></a>.</p>
</div>
<div class="section" id="Specifying-Phylo-HMMs">
<h3>Specifying Phylo-HMMs<a class="headerlink" href="#Specifying-Phylo-HMMs" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;GTR&quot;</span><span class="p">,</span> <span class="n">with_rate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sites_independent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;bprobs&#39;</span><span class="p">,</span> <span class="n">is_constant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For more detailed discussion of defining and using these models see <a class="reference internal" href="../examples/hmm_par_heterogeneity.html#rate-heterogeneity-hmm"><span class="std std-ref">Evaluate process heterogeneity using a Hidden Markov Model</span></a>.</p>
</div>
<div class="section" id="Fitting-likelihood-functions---Choice-of-optimisers">
<h3>Fitting likelihood functions - Choice of optimisers<a class="headerlink" href="#Fitting-likelihood-functions---Choice-of-optimisers" title="Permalink to this headline">¶</a></h3>
<p>There are 2 types of optimiser: simulated annealing, a <em>global</em> optimiser; and Powell, a <em>local</em> optimiser. The simulated annealing method is slow compared to Powell and in general Powell is an adequate choice. I setup a simple nucleotide model to illustrate these.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">load_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">load_aligned_seqs</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.fasta&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The default is to use Powell. For Powell, it’s recommended to set the <code class="docutils literal notranslate"><span class="pre">max_restarts</span></code> argument since this provides a mechanism for Powell to attempt restarting the optimisation from a slightly different spot which can help in overcoming local maxima.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_restarts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We might want to do crude simulated annealing following by more rigorous Powell. To do this we first need to use the global optimiser, setting <code class="docutils literal notranslate"><span class="pre">local=False</span></code> setting a large value for <code class="docutils literal notranslate"><span class="pre">global_tolerance</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">global_tolerance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Followed by a standard call to <code class="docutils literal notranslate"><span class="pre">optimise()</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_restarts</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">tolerance</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="How-to-check-your-optimisation-was-successful">
<h3>How to check your optimisation was successful<a class="headerlink" href="#How-to-check-your-optimisation-was-successful" title="Permalink to this headline">¶</a></h3>
<p>There is no guarantee that an optimised function has achieved a global maximum. We can, however, be sure that a maximum was achieved by validating that the optimiser stopped because the specified tolerance condition was met, rather than exceeding the maximum number of evaluations. The latter number is set to ensure optimisation doesn’t proceed endlessly. If the optimiser exited because this limit was exceeded you can be sure that the function <strong>has not</strong> been successfully optimised.</p>
<p>We can monitor this situation using the <code class="docutils literal notranslate"><span class="pre">limit_action</span></code> argument to <code class="docutils literal notranslate"><span class="pre">optimise</span></code>. Providing the value <code class="docutils literal notranslate"><span class="pre">raise</span></code> causes an exception to be raised if this condition occurs, as shown below. Providing <code class="docutils literal notranslate"><span class="pre">warn</span></code> (default) instead will cause a warning message to be printed to screen but execution will continue. The value <code class="docutils literal notranslate"><span class="pre">ignore</span></code> hides any such message.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">load_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">load_aligned_seqs</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.fasta&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit_action</span><span class="o">=</span><span class="s1">&#39;raise&#39;</span><span class="p">,</span>
             <span class="n">max_evaluations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_calculator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ArithmeticError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FORCED EXIT from optimiser after 10 evaluations
</pre></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We recommend using <code class="docutils literal notranslate"><span class="pre">limit_action='raise'</span></code> and catching the <code class="docutils literal notranslate"><span class="pre">ArithmeticError</span></code> error explicitly (as demonstrated above). You really shouldn’t be using results from such an optimisation run.</p>
</div>
</div>
<div class="section" id="Overview-of-the-fitted-likelihood-function">
<h3>Overview of the fitted likelihood function<a class="headerlink" href="#Overview-of-the-fitted-likelihood-function" title="Permalink to this headline">¶</a></h3>
<p>In Jupyter, the likelihood function object presents a representation of the main object features.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">load_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;GTR&quot;</span><span class="p">)</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">load_aligned_seqs</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.fasta&#39;</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<h4>Likelihood function statistics</h4>
<p>log-likelihood = -6992.7690</p>
<p>number of free parameters = 16</p>
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Global params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>A/C</th>
<th>A/G</th>
<th>A/T</th>
<th>C/G</th>
<th>C/T</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">1.2316</td>
<td style="font-family: monospace !important;">5.2534</td>
<td style="font-family: monospace !important;">0.9585</td>
<td style="font-family: monospace !important;">2.3159</td>
<td style="font-family: monospace !important;">5.9700</td>
</tr>
</tbody>
</table>

<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Edge params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>edge</th>
<th>parent</th>
<th>length</th>
</thead>
<tbody>
<tr>
<td>Galago</td>
<td>root</td>
<td style="font-family: monospace !important;">0.1731</td>
</tr>
<tr>
<td>HowlerMon</td>
<td>root</td>
<td style="font-family: monospace !important;">0.0449</td>
</tr>
<tr>
<td>Rhesus</td>
<td>edge.3</td>
<td style="font-family: monospace !important;">0.0216</td>
</tr>
<tr>
<td>Orangutan</td>
<td>edge.2</td>
<td style="font-family: monospace !important;">0.0077</td>
</tr>
<tr>
<td>Gorilla</td>
<td>edge.1</td>
<td style="font-family: monospace !important;">0.0025</td>
</tr>
<tr>
<td>Human</td>
<td>edge.0</td>
<td style="font-family: monospace !important;">0.0061</td>
</tr>
<tr>
<td>Chimpanzee</td>
<td>edge.0</td>
<td style="font-family: monospace !important;">0.0028</td>
</tr>
<tr>
<td>edge.0</td>
<td>edge.1</td>
<td style="font-family: monospace !important;">0.0000</td>
</tr>
<tr>
<td>edge.1</td>
<td>edge.2</td>
<td style="font-family: monospace !important;">0.0034</td>
</tr>
<tr>
<td>edge.2</td>
<td>edge.3</td>
<td style="font-family: monospace !important;">0.0120</td>
</tr>
<tr>
<td>edge.3</td>
<td>root</td>
<td style="font-family: monospace !important;">0.0076</td>
</tr>
</tbody>
</table>

<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Motif params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>A</th>
<th>C</th>
<th>G</th>
<th>T</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.3757</td>
<td style="font-family: monospace !important;">0.1742</td>
<td style="font-family: monospace !important;">0.2095</td>
<td style="font-family: monospace !important;">0.2406</td>
</tr>
</tbody>
</table></div>
</div>
<div class="section" id="Log-likelihood-and-number-of-free-parameters">
<h4>Log likelihood and number of free parameters<a class="headerlink" href="#Log-likelihood-and-number-of-free-parameters" title="Permalink to this headline">¶</a></h4>
<p>Reusing the optimised <code class="docutils literal notranslate"><span class="pre">lf</span></code> object from above, we can get the log-likelihood and the number of free parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lnL</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">lnL</span>
<span class="n">lnL</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-6992.768994254359
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nfp</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">nfp</span>
<span class="n">nfp</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
16
</pre></div></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The number of free parameters (nfp) refers only to the number of parameters that were modifiable by the optimiser. Typically, the degrees-of-freedom of a likelihood ratio test statistic is computed as the difference in nfp between models. This will not be correct for models in which a boundary conditions exist (rate heterogeneity models where a parameter value boundary is set between bins).</p>
</div>
</div>
<div class="section" id="Aikake-Information-Criterion">
<h4>Aikake Information Criterion<a class="headerlink" href="#Aikake-Information-Criterion" title="Permalink to this headline">¶</a></h4>
<p>Reusing the optimised <code class="docutils literal notranslate"><span class="pre">lf</span></code> object from above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span><span class="o">.</span><span class="n">get_aic</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
14017.537988508719
</pre></div></div>
</div>
<p>We can also get the second-order AIC.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span><span class="o">.</span><span class="n">get_aic</span><span class="p">(</span><span class="n">second_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
14017.732482609541
</pre></div></div>
</div>
</div>
<div class="section" id="Bayesian-Information-Criterion">
<h4>Bayesian Information Criterion<a class="headerlink" href="#Bayesian-Information-Criterion" title="Permalink to this headline">¶</a></h4>
<p>Reusing the optimised <code class="docutils literal notranslate"><span class="pre">lf</span></code> object from above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span><span class="o">.</span><span class="n">get_bic</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
14112.615784311509
</pre></div></div>
</div>
</div>
<div class="section" id="Getting-maximum-likelihood-estimates">
<h4>Getting maximum likelihood estimates<a class="headerlink" href="#Getting-maximum-likelihood-estimates" title="Permalink to this headline">¶</a></h4>
<p>Reusing the optimised <code class="docutils literal notranslate"><span class="pre">lf</span></code> object from above.</p>
<div class="section" id="One-at-a-time">
<h5>One at a time<a class="headerlink" href="#One-at-a-time" title="Permalink to this headline">¶</a></h5>
<p>We get the statistics out individually. We get the <code class="docutils literal notranslate"><span class="pre">length</span></code> for the Human edge and the exchangeability parameter <code class="docutils literal notranslate"><span class="pre">A/G</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">a_g</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">get_param_value</span><span class="p">(</span><span class="s1">&#39;A/G&#39;</span><span class="p">)</span>
<span class="n">a_g</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
5.253427222418745
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">human</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">get_param_value</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="s1">&#39;Human&#39;</span><span class="p">)</span>
<span class="n">human</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.006060124812429323
</pre></div></div>
</div>
</div>
<div class="section" id="Just-the-motif-probabilities">
<h5>Just the motif probabilities<a class="headerlink" href="#Just-the-motif-probabilities" title="Permalink to this headline">¶</a></h5>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mprobs</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">get_motif_probs</span><span class="p">()</span>
<span class="n">mprobs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>T</th>
<th>C</th>
<th>A</th>
<th>G</th>
</thead>
<tbody>
<tr>
<td style="background: rgba(161, 195, 209, 0.25); font-weight: 600;">0.2406</td>
<td style="font-family: monospace !important;">0.1742</td>
<td style="font-family: monospace !important;">0.3757</td>
<td style="font-family: monospace !important;">0.2095</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="As-tables">
<h5>As tables<a class="headerlink" href="#As-tables" title="Permalink to this headline">¶</a></h5>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tables</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">(</span><span class="n">with_motif_probs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># just displaying the first</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">global params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>A/C</th>
<th>A/G</th>
<th>A/T</th>
<th>C/G</th>
<th>C/T</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">1.2316</td>
<td style="font-family: monospace !important;">5.2534</td>
<td style="font-family: monospace !important;">0.9585</td>
<td style="font-family: monospace !important;">2.3159</td>
<td style="font-family: monospace !important;">5.9700</td>
</tr>
</tbody>
</table>
<p>
1 rows x 5 columns</p></div>
</div>
</div>
</div>
</div>
<div class="section" id="Testing-Hypotheses---Using-Likelihood-Ratio-Tests">
<h3>Testing Hypotheses - Using Likelihood Ratio Tests<a class="headerlink" href="#Testing-Hypotheses---Using-Likelihood-Ratio-Tests" title="Permalink to this headline">¶</a></h3>
<p>We test the molecular clock hypothesis for human and chimpanzee lineages. The null has these two branches constrained to be equal.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">load_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">load_aligned_seqs</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.fasta&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">tip_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Human&#39;</span><span class="p">,</span> <span class="s1">&#39;Chimpanzee&#39;</span><span class="p">],</span>
        <span class="n">outgroup_name</span><span class="o">=</span><span class="s1">&#39;Galago&#39;</span><span class="p">,</span> <span class="n">clade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_independent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;Null Hypothesis&#39;</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">null_lnL</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">lnL</span>
<span class="n">null_nfp</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">nfp</span>
<span class="n">lf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<h4>Null Hypothesis</h4>
<p>log-likelihood = -7177.4403</p>
<p>number of free parameters = 10</p>
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Edge params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>edge</th>
<th>parent</th>
<th>length</th>
</thead>
<tbody>
<tr>
<td>Galago</td>
<td>root</td>
<td style="font-family: monospace !important;">0.1666</td>
</tr>
<tr>
<td>HowlerMon</td>
<td>root</td>
<td style="font-family: monospace !important;">0.0438</td>
</tr>
<tr>
<td>Rhesus</td>
<td>edge.3</td>
<td style="font-family: monospace !important;">0.0215</td>
</tr>
<tr>
<td>Orangutan</td>
<td>edge.2</td>
<td style="font-family: monospace !important;">0.0077</td>
</tr>
<tr>
<td>Gorilla</td>
<td>edge.1</td>
<td style="font-family: monospace !important;">0.0025</td>
</tr>
<tr>
<td>Human</td>
<td>edge.0</td>
<td style="font-family: monospace !important;">0.0045</td>
</tr>
<tr>
<td>Chimpanzee</td>
<td>edge.0</td>
<td style="font-family: monospace !important;">0.0045</td>
</tr>
<tr>
<td>edge.0</td>
<td>edge.1</td>
<td style="font-family: monospace !important;">0.0000</td>
</tr>
<tr>
<td>edge.1</td>
<td>edge.2</td>
<td style="font-family: monospace !important;">0.0035</td>
</tr>
<tr>
<td>edge.2</td>
<td>edge.3</td>
<td style="font-family: monospace !important;">0.0117</td>
</tr>
<tr>
<td>edge.3</td>
<td>root</td>
<td style="font-family: monospace !important;">0.0085</td>
</tr>
</tbody>
</table>

<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Motif params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>A</th>
<th>C</th>
<th>G</th>
<th>T</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.3757</td>
<td style="font-family: monospace !important;">0.1742</td>
<td style="font-family: monospace !important;">0.2095</td>
<td style="font-family: monospace !important;">0.2406</td>
</tr>
</tbody>
</table></div>
</div>
<p>The alternate allows the human and chimpanzee branches to differ by just setting all lengths to be independent.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">is_independent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;Alt Hypothesis&#39;</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">alt_lnL</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">lnL</span>
<span class="n">alt_nfp</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">nfp</span>
<span class="n">lf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<h4>Alt Hypothesis</h4>
<p>log-likelihood = -7175.7756</p>
<p>number of free parameters = 11</p>
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Edge params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>edge</th>
<th>parent</th>
<th>length</th>
</thead>
<tbody>
<tr>
<td>Galago</td>
<td>root</td>
<td style="font-family: monospace !important;">0.1666</td>
</tr>
<tr>
<td>HowlerMon</td>
<td>root</td>
<td style="font-family: monospace !important;">0.0438</td>
</tr>
<tr>
<td>Rhesus</td>
<td>edge.3</td>
<td style="font-family: monospace !important;">0.0215</td>
</tr>
<tr>
<td>Orangutan</td>
<td>edge.2</td>
<td style="font-family: monospace !important;">0.0077</td>
</tr>
<tr>
<td>Gorilla</td>
<td>edge.1</td>
<td style="font-family: monospace !important;">0.0025</td>
</tr>
<tr>
<td>Human</td>
<td>edge.0</td>
<td style="font-family: monospace !important;">0.0061</td>
</tr>
<tr>
<td>Chimpanzee</td>
<td>edge.0</td>
<td style="font-family: monospace !important;">0.0028</td>
</tr>
<tr>
<td>edge.0</td>
<td>edge.1</td>
<td style="font-family: monospace !important;">0.0000</td>
</tr>
<tr>
<td>edge.1</td>
<td>edge.2</td>
<td style="font-family: monospace !important;">0.0035</td>
</tr>
<tr>
<td>edge.2</td>
<td>edge.3</td>
<td style="font-family: monospace !important;">0.0117</td>
</tr>
<tr>
<td>edge.3</td>
<td>root</td>
<td style="font-family: monospace !important;">0.0085</td>
</tr>
</tbody>
</table>

<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Motif params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>A</th>
<th>C</th>
<th>G</th>
<th>T</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.3757</td>
<td style="font-family: monospace !important;">0.1742</td>
<td style="font-family: monospace !important;">0.2095</td>
<td style="font-family: monospace !important;">0.2406</td>
</tr>
</tbody>
</table></div>
</div>
<p>We import the function for computing the probability of a chi-square test statistic, compute the likelihood ratio test statistic, degrees of freedom and the corresponding probability.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3.maths.stats</span> <span class="kn">import</span> <span class="n">chisqprob</span>

<span class="n">LR</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">alt_lnL</span> <span class="o">-</span> <span class="n">null_lnL</span><span class="p">)</span> <span class="c1"># the likelihood ratio statistic</span>
<span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">alt_nfp</span> <span class="o">-</span> <span class="n">null_nfp</span><span class="p">)</span> <span class="c1"># the test degrees of freedom</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">chisqprob</span><span class="p">(</span><span class="n">LR</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;LR=</span><span class="si">{</span><span class="n">LR</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> ; df=</span><span class="si">{</span><span class="n">df</span><span class="si">}</span><span class="s1">; p=</span><span class="si">{</span><span class="n">df</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
LR=3.3294 ; df=1; p=1.0000
</pre></div></div>
</div>
<div class="section" id="Testing-Hypotheses---By-parametric-bootstrapping">
<h4>Testing Hypotheses - By parametric bootstrapping<a class="headerlink" href="#Testing-Hypotheses---By-parametric-bootstrapping" title="Permalink to this headline">¶</a></h4>
<p>If we can’t rely on the asymptotic behaviour of the LRT, e.g. due to small alignment length, we can use a parametric bootstrap. Convenience functions for that are described in more detail here <a class="reference internal" href="../examples/parametric_bootstrap.html#parametric-bootstrap"><span class="std std-ref">Performing a parametric bootstrap</span></a>.</p>
<p>In general, however, this capability derives from the ability of any defined <code class="docutils literal notranslate"><span class="pre">evolve</span></code> likelihood function to simulate an alignment. This property is provided as <code class="docutils literal notranslate"><span class="pre">simulate_alignment</span></code> method on likelihood function objects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">load_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">load_aligned_seqs</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.fasta&#39;</span><span class="p">)</span>

<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_param_rule</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="n">tip_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Human&#39;</span><span class="p">,</span> <span class="s1">&#39;Chimpanzee&#39;</span><span class="p">],</span>
        <span class="n">outgroup_name</span><span class="o">=</span><span class="s1">&#39;Galago&#39;</span><span class="p">,</span> <span class="n">clade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">is_independent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="s1">&#39;Null Hypothesis&#39;</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">sim_aln</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">simulate_alignment</span><span class="p">()</span>
<span class="n">sim_aln</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>
tr { line-height: 3pt ; }
.blank_row{ line-height: 12pt !important; opacity: 0.10; }
td { border: none !important; text-align: left !important; }
.label { font-size: 12pt ; text-align: right !important; color: black !important; }
.T_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: blue; }
.C_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: black; }
.A_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: #FF0102; }
.G_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: green; }
.terminal_ambig_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: gray; }
.ambig_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: gray; }
</style>
<body>
<table>
<tr style="background-color:rgba(161, 195, 209, 0.5);"><td></td><td><b>0</b></td></tr>
<tr><td class="label">Rhesus</td><td><span class="A_dna">A</span><span class="G_dna">G</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="C_dna">C</span><span class="C_dna">C</span><span class="T_dna">T</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="C_dna">C</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="G_dna">G</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="G_dna">G</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="G_dna">G</span><span class="G_dna">G</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="G_dna">G</span><span class="G_dna">G</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="C_dna">C</span><span class="T_dna">T</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="G_dna">G</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="G_dna">G</span><span class="C_dna">C</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="C_dna">C</span></td></tr>
<tr><td class="label">Chimpanzee</td><td><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="T_dna">T</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">C</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span></td></tr>
<tr><td class="label">Galago</td><td><span class="A_dna">.</span><span class="T_dna">T</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="T_dna">T</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="G_dna">G</span><span class="G_dna">G</span><span class="C_dna">.</span><span class="A_dna">A</span><span class="T_dna">.</span><span class="G_dna">G</span><span class="C_dna">C</span><span class="A_dna">.</span><span class="C_dna">C</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="T_dna">T</span><span class="T_dna">T</span><span class="G_dna">G</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="T_dna">T</span><span class="A_dna">.</span><span class="T_dna">T</span><span class="C_dna">.</span><span class="G_dna">.</span><span class="T_dna">T</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">G</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="C_dna">.</span></td></tr>
<tr><td class="label">Gorilla</td><td><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="T_dna">T</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">C</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span></td></tr>
<tr><td class="label">HowlerMon</td><td><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="G_dna">G</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">C</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="G_dna">G</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span></td></tr>
<tr><td class="label">Human</td><td><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="T_dna">T</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">C</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span></td></tr>
<tr><td class="label">Orangutan</td><td><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="T_dna">T</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">C</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span></td></tr>
</table>
<p><i>7 x 60 dna alignment</i></p>
</body></div>
</div>
</div>
</div>
<div class="section" id="Determining-confidence-intervals-on-MLEs">
<h3>Determining confidence intervals on MLEs<a class="headerlink" href="#Determining-confidence-intervals-on-MLEs" title="Permalink to this headline">¶</a></h3>
<p>The profile method is used to calculate a confidence interval for a named parameter. We show it here for a global substitution model exchangeability parameter (<em>kappa</em>, the ratio of transition to transversion rates) and for an edge specific parameter (just the human branch length).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">load_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">load_aligned_seqs</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.fasta&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;HKY85&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">kappa_lo</span><span class="p">,</span> <span class="n">kappa_mle</span><span class="p">,</span> <span class="n">kappa_hi</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">get_param_interval</span><span class="p">(</span><span class="s1">&#39;kappa&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lo=</span><span class="si">{</span><span class="n">kappa_lo</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ; mle=</span><span class="si">{</span><span class="n">kappa_mle</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ; hi=</span><span class="si">{</span><span class="n">kappa_hi</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">human_lo</span><span class="p">,</span> <span class="n">human_mle</span><span class="p">,</span> <span class="n">human_hi</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">get_param_interval</span><span class="p">(</span><span class="s1">&#39;length&#39;</span><span class="p">,</span> <span class="s1">&#39;Human&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lo=</span><span class="si">{</span><span class="n">human_lo</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ; mle=</span><span class="si">{</span><span class="n">human_mle</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ; hi=</span><span class="si">{</span><span class="n">human_hi</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
lo=3.78 ; mle=4.44 ; hi=5.22
lo=0.00 ; mle=0.01 ; hi=0.01
</pre></div></div>
</div>
</div>
<div class="section" id="Saving-results">
<h3>Saving results<a class="headerlink" href="#Saving-results" title="Permalink to this headline">¶</a></h3>
<p>The best approach is to use the json string from the <code class="docutils literal notranslate"><span class="pre">to_json()</span></code> method. The saved data can be later reloaded using <code class="docutils literal notranslate"><span class="pre">cogent3.util.deserialise.deserialise_object()</span></code>. The <code class="docutils literal notranslate"><span class="pre">json</span></code> data contains the alignment, tree topology, substitution model, parameter values, etc..</p>
<p>To illustrate this, I create a very simple likelihood function. The <code class="docutils literal notranslate"><span class="pre">json</span></code> variable below is just a string that can be saved to disk.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">load_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">aln</span> <span class="o">=</span> <span class="n">make_aligned_seqs</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s2">&quot;ACGG&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s2">&quot;ATAG&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;ATGG&quot;</span><span class="p">))</span>
<span class="n">tree</span> <span class="o">=</span> <span class="n">make_tree</span><span class="p">(</span><span class="n">tip_names</span><span class="o">=</span><span class="n">aln</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="n">json</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">to_json</span><span class="p">()</span>
<span class="n">json</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span>  <span class="c1"># just truncating the displayed string</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;{&#34;model&#34;: {&#34;alphabet&#34;: {&#34;motifset&#34;: [&#34;T&#34;, &#34;C&#34;, &#34;A&#34;, &#34;G&#34;], &#34;g&#39;
</pre></div></div>
</div>
<p>We deserialise the object from the string.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3.util.deserialise</span> <span class="kn">import</span> <span class="n">deserialise_object</span>

<span class="n">newlf</span> <span class="o">=</span> <span class="n">deserialise_object</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>
<span class="n">newlf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<h4>unnamed</h4>
<p>log-likelihood = -14.2727</p>
<p>number of free parameters = 3</p>
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Edge params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>edge</th>
<th>parent</th>
<th>length</th>
</thead>
<tbody>
<tr>
<td>a</td>
<td>root</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
<tr>
<td>b</td>
<td>root</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
<tr>
<td>c</td>
<td>root</td>
<td style="font-family: monospace !important;">1.0000</td>
</tr>
</tbody>
</table>

<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<caption style="color: rgb(250, 250, 250); background: rgba(30, 140, 200, 1); align=top;"><span style="font-weight: bold;">Motif params</span><span></span></caption>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>A</th>
<th>C</th>
<th>G</th>
<th>T</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.3333</td>
<td style="font-family: monospace !important;">0.0833</td>
<td style="font-family: monospace !important;">0.4167</td>
<td style="font-family: monospace !important;">0.1667</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="Reconstructing-ancestral-sequences">
<h3>Reconstructing ancestral sequences<a class="headerlink" href="#Reconstructing-ancestral-sequences" title="Permalink to this headline">¶</a></h3>
<p>We first fit a likelihood function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">cogent3</span> <span class="kn">import</span> <span class="n">load_tree</span><span class="p">,</span> <span class="n">load_aligned_seqs</span>
<span class="kn">from</span> <span class="nn">cogent3.evolve.models</span> <span class="kn">import</span> <span class="n">get_model</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">load_tree</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.tree&#39;</span><span class="p">)</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">load_aligned_seqs</span><span class="p">(</span><span class="s1">&#39;../data/primate_brca1.fasta&#39;</span><span class="p">)</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;F81&quot;</span><span class="p">)</span>
<span class="n">lf</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">make_likelihood_function</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">set_alignment</span><span class="p">(</span><span class="n">aln</span><span class="p">)</span>
<span class="n">lf</span><span class="o">.</span><span class="n">optimise</span><span class="p">(</span><span class="n">show_progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We then get the most likely ancestral sequences.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ancestors</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">likely_ancestral_seqs</span><span class="p">()</span>
<span class="n">ancestors</span><span class="p">[:</span><span class="mi">60</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style>
tr { line-height: 3pt ; }
.blank_row{ line-height: 12pt !important; opacity: 0.10; }
td { border: none !important; text-align: left !important; }
.label { font-size: 12pt ; text-align: right !important; color: black !important; }
.T_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: blue; }
.C_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: black; }
.A_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: #FF0102; }
.G_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: green; }
.terminal_ambig_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: gray; }
.ambig_dna{font-family: "Lucida Console",monospace !important; font-size: 12pt !important; color: gray; }
</style>
<body>
<table>
<tr style="background-color:rgba(161, 195, 209, 0.5);"><td></td><td><b>0</b></td></tr>
<tr><td class="label">root</td><td><span class="T_dna">T</span><span class="G_dna">G</span><span class="T_dna">T</span><span class="G_dna">G</span><span class="G_dna">G</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="T_dna">T</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="G_dna">G</span><span class="C_dna">C</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="G_dna">G</span><span class="C_dna">C</span><span class="T_dna">T</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="G_dna">G</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="T_dna">T</span><span class="G_dna">G</span><span class="A_dna">A</span><span class="G_dna">G</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="G_dna">G</span><span class="T_dna">T</span><span class="T_dna">T</span><span class="T_dna">T</span><span class="G_dna">G</span><span class="T_dna">T</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="T_dna">T</span><span class="C_dna">C</span><span class="A_dna">A</span><span class="C_dna">C</span><span class="T_dna">T</span><span class="A_dna">A</span><span class="A_dna">A</span><span class="A_dna">A</span></td></tr>
<tr><td class="label">edge.0</td><td><span class="T_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">A</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span></td></tr>
<tr><td class="label">edge.1</td><td><span class="T_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">A</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span></td></tr>
<tr><td class="label">edge.2</td><td><span class="T_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">A</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span></td></tr>
<tr><td class="label">edge.3</td><td><span class="T_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="G_dna">.</span><span class="T_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="C_dna">.</span><span class="A_dna">.</span><span class="C_dna">.</span><span class="T_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span><span class="A_dna">.</span></td></tr>
</table>
<p><i>5 x 60 dna alignment</i></p>
</body></div>
</div>
<p>Or we can get the posterior probabilities (returned as a <code class="docutils literal notranslate"><span class="pre">DictArray</span></code>) of sequence states at each node.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ancestral_probs</span> <span class="o">=</span> <span class="n">lf</span><span class="o">.</span><span class="n">reconstruct_ancestral_seqs</span><span class="p">()</span>
<span class="n">ancestral_probs</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">][:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<table>
<style>
tr:last-child {border-bottom: 1px solid #000;} tr > th {text-align: center !important;} tr > td {text-align: left !important;}
</style>
<thead style="background: rgba(161, 195, 209, 0.75); font-weight: bold; text-align: center;">
<th>T</th>
<th>C</th>
<th>A</th>
<th>G</th>
</thead>
<tbody>
<tr>
<td style="font-family: monospace !important;">0.1816</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
</tr>
<tr>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.1561</td>
</tr>
<tr>
<td style="font-family: monospace !important;">0.1816</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
</tr>
<tr>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.1561</td>
</tr>
<tr>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.0000</td>
<td style="font-family: monospace !important;">0.1561</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div class="section" id="Tips-for-improved-performance-–-sequentially-build-the-fitting">
<h3>Tips for improved performance – sequentially build the fitting<a class="headerlink" href="#Tips-for-improved-performance-–-sequentially-build-the-fitting" title="Permalink to this headline">¶</a></h3>
<p>There’s nothing that improves performance quite like being close to the maximum likelihood values. So using the <code class="docutils literal notranslate"><span class="pre">set_param_rule</span></code> method to provide good starting values can be very useful. As this can be difficult to do one easy way is to build simpler models that are nested within the one you’re interested in. Fitting those models and then relaxing constraints until you’re at the parameterisation of interest can markedly improve optimisation speed.</p>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, cogent3.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/cookbook/evo_modelling.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>